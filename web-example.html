<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Chat Client</title>
        <style>
            @font-face {
                font-family: "Vulf Sans";
                font-style: normal;
                font-weight: 400;
                src: url("//grantshandy.github.io/Vulf_Sans-Regular.woff2");
            }
        </style>
        <link href="//unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet">
    </head>
    <body>
        <div class="w-screen h-screen flex justify-center items-center">
            <div class="rounded-md w-3/5 h-3/5 bg-gray-300 p-3 text-center space-y-3">
                <h3 class="text-3xl font-semibold">Chat Client</h3>
                <p>My Username: <input type="text" id="username"></p>
                <div id="chatLogs" class="overflow-y-scroll bg-white font-mono h-2/3"></div>
                <p><input type="text" id="input"><input type="button" value="Send" onclick="clickPress()"></p>
            </div>
        </div>
        <script>
            const chatLogs = document.getElementById('chatLogs');
            const inputBox = document.getElementById('input');
            const username = document.getElementById('username');

            const messageSource = new EventSource(`${window.location.href}stream_messages`, { mode: 'no-cors' });

            messageSource.onmessage = function(event) {
                let message = JSON.parse(event.data);
                let time = new Date(message.time);

                chatLogs.innerHTML += "<p>["+message.user+"]: "+message.text+"</p>";
                chatLogs.scrollTop = chatLogs.scrollHeight;
            }

            async function clickPress() {
                await fetch(`${window.location.href}message`, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: JSON.stringify({text: inputBox.value, user: username.value})
                });

                inputBox.value = "";
            }
        </script>
    </body>
</html>